import { useState, useEffect } from "react";
import NextImage from "next/image";

const Image = ({ src, ...props }) => {
  const [imgSrc, setImgSrc] = useState(src);

  const loader = ({ src, width, quality }) =>
    `${src}?w=${width}&q=${quality || 75}`;

  const placeholder =
    "data:image/svg+xml,%3Csvg width='160' height='160' viewBox='0 0 160 160' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M72 72C72 73.3334 71.5328 74.4662 70.5984 75.3984C69.664 76.3307 68.5312 76.7979 67.2 76.8C65.8688 76.8022 64.736 76.335 63.8016 75.3984C62.8672 74.4619 62.4 73.3291 62.4 72C62.4 70.671 62.8672 69.5382 63.8016 68.6016C64.736 67.6651 65.8688 67.1979 67.2 67.2C68.5312 67.2022 69.664 67.6694 70.5984 68.6016C71.5328 69.5339 72 70.6667 72 72ZM97.6 81.6V92.8H62.4V88L70.4 80L74.4 84L87.2 71.2L97.6 81.6ZM100 64H60C59.7824 64 59.5947 64.079 59.4368 64.2368C59.2789 64.3947 59.2 64.5824 59.2 64.8V95.2C59.2 95.4176 59.2789 95.6054 59.4368 95.7632C59.5947 95.9211 59.7824 96 60 96H100C100.218 96 100.405 95.9211 100.563 95.7632C100.721 95.6054 100.8 95.4176 100.8 95.2V64.8C100.8 64.5824 100.721 64.3947 100.563 64.2368C100.405 64.079 100.218 64 100 64ZM104 64.8V95.2C104 96.3008 103.609 97.2427 102.826 98.0256C102.043 98.8086 101.101 99.2 100 99.2H60C58.8992 99.2 57.9573 98.8086 57.1744 98.0256C56.3915 97.2427 56 96.3008 56 95.2V64.8C56 63.6992 56.3915 62.7574 57.1744 61.9744C57.9573 61.1915 58.8992 60.8 60 60.8H100C101.101 60.8 102.043 61.1915 102.826 61.9744C103.609 62.7574 104 63.6992 104 64.8Z' fill='%23BFBFBF'/%3E%3C/svg%3E%0A";

  useEffect(() => {
    setImgSrc(src);
  }, [src]);

  return (
    <NextImage
      {...{ loader, ...props }}
      src={imgSrc}
      onError={() => {
        setImgSrc(placeholder);
      }}
    />
  );
};

export default Image;
